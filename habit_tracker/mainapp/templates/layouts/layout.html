{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>        
         {% block title %}
           <!-- Titulo --> 
         {% endblock %}
         | Equipo 6
    </title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/layout.css' %}">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="{% url 'inicio' %}">
          <img class="logo" src="{% static 'images/logo-habittrack.svg' %}">
          <span class="brand">HabitTrack</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>      
      <div class="collapse navbar-collapse" id="navbarNav">
        <!-- Enlaces a la izquierda -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'diario' %}">Diario</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'lista_habitos' %}">Habitos</a>
          </li> 
          <li class="nav-item">
            <a class="nav-link" href="{% url 'crear_habito' %}">Crear Hábito</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'progreso' %}">Progreso</a>
          </li> 
        </ul>
        <!-- Enlaces a la derecha -->
        <ul class="navbar-nav ms-auto">
            {% if usuario %}
              <li class="nav-item">
                  <a class="nav-link" href="{% url 'logout' %}">Cerrar Sesión</a>
              </li>
              <li>
                <!-- Icono de notificaciones con cuadro emergente -->
                <div class="notification-icon" onclick="toggleNotificationPopup()">
                  <div class="notification-bell">
                    <i class="fa fa-bell"></i>
                    <span class="notification-count badge badge-info" id="notification-count">
                        {% if notificaciones_no_leidas %}
                            {{ notificaciones_no_leidas }}
                        {% else %}
                            0
                        {% endif %}
                    </span>
                  </div>
                  <!-- Cuadro emergente para notificaciones -->
                  <div id="notification-popup" class="notification-popup">
                    <div id="notification-content">
                      {% if notificaciones %}
                          {% for notificacion in notificaciones %}
                              <div class="notification-item">
                                  <div class="notification-title">{{ notificacion.titulo }}</div>
                                  <div class="notification-message">{{ notificacion.descripcion }}</div>
                                  <div class="notification-subtext">{{ notificacion.mensaje_motivacional }}</div>
                              </div>
                          {% endfor %}
                      {% else %}
                          <div class="notification-item">
                              <div class="notification-message">¡Felicitaciones! Has completado todos tus hábitos hoy.</div>
                          </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </li>
              <div class="perfil-icon">
                <i class="fa-solid fa-user"></i>
              </div>
            {% else %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'login' %}">Iniciar sesion</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'register' %}">Registrarse</a>
              </li>
            {% endif %}            
        </ul>
      </div>
    </nav>
    <!-- Contenedor principal -->
    <div class="content-wrapper">
      {% block content %}
          <!-- Contenido -->
      {% endblock %}
    </div>
    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
          <!-- Logo y breve descripción -->
          <div class="footer-section about">
            <svg id="Layer_1" data-name="logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 93.11 59.69">
              <path class="cls-1" d="M44.25,29.16c1.02-3.54,2.03-7.07,3.05-10.61.1-.33.16-.68.31-.99.29-.64.64-1.27,1.45-1.3.78-.03,1.28.45,1.6,1.12.62,1.29,1.22,2.59,1.83,3.88.3.63.62,1.28,1.45,1.3,4.36.09,8.72.31,13.07-.09,2.21-.2,3.26-1.42,3.76-3.64,1.22-5.35-1.12-11.4-5.72-14.15-4.87-2.91-10.87-2.55-15.21,1.09-.38.32-.74.66-1.11.99-1.24,1.1-1.82,1.13-3.05-.03-2.22-2.1-4.85-3.34-7.84-3.91-5.58-1.05-12.24,3.12-13.75,8.62-.49,1.77-.88,3.53-.77,5.39.04.73,0,1.56-1.08,1.61-1.05.05-1.36-.6-1.41-1.5-.37-6.57,2.12-11.72,7.98-14.87,5.8-3.12,11.53-2.73,16.83,1.28,1.14.86,1.9.96,3.09.06,8.09-6.12,19.38-3.35,23.64,5.87,2.11,4.56,1.81,9.22-.35,13.72-.56,1.18-1.72,1.8-3.01,1.93-5.33.54-10.66.87-16.02.33-1.26-.13-2-.85-2.33-1.97-.24-.82-.68-1.51-1.18-2.53-.68,2.17-1.29,4.08-1.87,5.99-.57,1.89-1.14,3.77-1.65,5.68-.25.94-.8,1.75-1.68,1.88-.95.14-1.37-.83-1.7-1.6-1.09-2.53-2.21-5.06-3.19-7.64-.49-1.3-1.24-1.86-2.64-1.84-5.85.05-11.7.06-17.55,0-1.39-.01-1.78.49-1.73,1.82.11,2.72.12,5.44.08,8.16-.03,2.36-.91,3.49-2.97,4-.33.08-.75.2-1.01.06-1.85-.97-4.19-.91-5.77-1.98-1.68-1.14-3.23-2.27-5.19-2.91-1.03-.34-1.34-1.56-1.36-2.63-.04-2.32-.06-4.65.02-6.97.07-1.96,1.1-3.05,3.1-3.33.89-.13,1.4-.47,1.73-1.33.53-1.35,1.58-2.14,3.08-2.14.87,0,1.49-.38,2.06-.99,1.14-1.24,2.49-1.74,4.14-1.09,1.68.66,2.21,2.06,2.18,3.69-.05,2.98-.31,2.85,2.91,2.85,5.8,0,11.6-.02,17.4-.03,2.02,0,2.51.45,3.23,2.34.83,2.19,1.84,4.32,2.77,6.48.12-.02.25-.04.37-.06ZM14.92,25.39s0,0,0,0c0-2.41-.01-4.83,0-7.24,0-.71-.18-1.46-.87-1.49-.76-.04-1.09.66-1.09,1.46.01,4.78.01,9.56,0,14.34,0,.82.26,1.66,1.08,1.65.76-.01.87-.89.86-1.62-.02-2.37,0-4.73,0-7.1ZM8.32,25.75s.02,0,.03,0c0,1.78.01,3.55,0,5.33,0,.77.24,1.56,1,1.53.63-.02,1.11-.7,1.1-1.53-.02-3.6-.01-7.2-.02-10.8,0-.74-.27-1.52-1.07-1.53-.81,0-1.03.77-1.03,1.52,0,1.82,0,3.65,0,5.47ZM5.65,26.5s-.04,0-.06,0c0-.98.11-1.98-.05-2.93-.07-.42-.13-1.26-.8-1.25-.69.01-.86.77-.93,1.31-.23,1.81-.16,3.63-.06,5.44.03.6.4,1.12.97,1.11.59-.01.86-.63.91-1.18.07-.83.02-1.67.02-2.5Z"/>
              <path class="cls-1" d="M76.87,20.98c0-1.48-.04-2.97,0-4.45.05-1.57.52-2.93,2.16-3.54,1.63-.61,3.01-.2,4.12,1.12.44.53.99.75,1.68.79,1.61.08,2.86.77,3.44,2.36.34.94,1.09,1.19,1.95,1.36,1.95.37,2.71,1.1,2.8,3.04.11,2.47.1,4.94.02,7.41-.06,1.74-1.15,2.84-2.88,3.01-1.04.1-1.8.41-2.52,1.26-.83.98-1.95,1.76-3.4,1.65-.64-.05-1.12.28-1.63.61-2.47,1.62-5.03.54-5.56-2.34-.12-.63-.15-1.28-.17-1.92-.05-1.93-.05-1.94-2.05-1.95-7.07-.02-6.93.1-11.87,5.59-2.8,3.11-6.37,5.47-9.79,7.92-1.41,1-2.86,1.95-4.28,2.94-1.1.77-2.14.81-3.29.04-4.77-3.2-9.52-6.46-13.64-10.46-2.57-2.49-5.07-5.1-7.2-8.01-.49-.67-1-1.37-.17-2.07.9-.76,1.54-.09,2.1.59,2.37,2.93,5.14,5.47,7.81,8.12,3.39,3.36,7.33,5.95,11.13,8.77,1.12.84,2.04.81,3.18.02,3.33-2.33,6.72-4.59,9.67-7.37,2.03-1.92,4.22-3.69,5.98-5.9,1.73-2.17,4.12-2.76,6.77-2.67,1.29.04,2.58,0,3.86.13,1.36.13,1.9-.35,1.81-1.74-.1-1.43-.02-2.87-.02-4.3h0ZM79.46,24.08s-.02,0-.03,0c0,2.42.02,4.84,0,7.26,0,.83.3,1.69,1.02,1.74.6.03.98-.84.97-1.6-.02-4.89-.02-9.78-.05-14.67,0-.64-.06-1.37-.98-1.37-.92,0-.93.71-.93,1.37,0,2.42,0,4.84,0,7.26ZM86.04,25.01c0-1.88,0-3.75,0-5.63,0-.76-.18-1.51-1-1.56-.86-.05-1.1.72-1.11,1.46-.01,3.75,0,7.5.01,11.25,0,.75.28,1.45,1.17,1.39.81-.06.93-.74.92-1.44-.01-1.83,0-3.65,0-5.48ZM90.49,25.44h.02c0-.98,0-1.97,0-2.95,0-.56-.36-.99-.84-1.07-.51-.08-.79.48-.83.88-.2,2-.23,4.02-.01,6.03.04.37.31,1,.79.94.54-.06.88-.56.88-1.17,0-.88,0-1.77,0-2.65Z"/>
              <path class="cls-1" d="M86.89,52.41c.71-.93,1.15-1.65,1.72-2.23.93-.94,2.12-1.21,3.43-.98.43.08,1.01.04.78.73-.14.41-.21.88-1.01.7-1.9-.42-3.34.27-4.28,1.83-.17.28-.48.57-.27.94.24.44.6.15.92.09,1.07-.21,1.79.16,2.25,1.17.37.81.87,1.55,1.29,2.33.39.73.75,1.47,1.2,2.35-1.13.16-1.83.17-2.31-1.13-.54-1.46-1.5-2.77-2.31-4.13-.19-.31-.4-.74-.89-.57-.43.15-.52.58-.52.98,0,1.33-.05,2.67.02,4,.04.71-.14.94-.87.95-.8,0-.69-.44-.69-.95.02-2.82.02-5.64,0-8.45,0-.5-.13-.98.68-.98.73,0,.95.25.87.97-.07.68-.02,1.37-.02,2.38Z"/>
              <path class="cls-1" d="M68.73,54.92c-.2-2.06-1.37-3.74-2.16-5.66,1.04-.43,1.72-.22,2.19.99,1.17,3.01,2.44,5.98,3.69,9.01-1.28.46-1.79.06-2.15-1.16-.92-3.11-1.28-3.15-3.5-.8-.27.29-.57.55-.81.86-.95,1.2-2.12,1.6-2.97.98-.79-.57-.81-2.05-.04-3.31.06.06.16.11.18.17.1.59-.42,1.39.33,1.74.75.35,1.27-.35,1.77-.79.52-.45,1-.96,1.43-1.5.57-.71,1.24-.92,2.08-.58.05.06.09.13.14.19.01-.06.03-.12.04-.18-.07,0-.14.02-.2.03Z"/>
              <path class="cls-1" d="M19.68,59.29c-1.37.42-1.85-.06-2.18-1.28-.81-2.92-1.42-3.01-3.47-.76-.33.36-.7.7-.97,1.1-.72,1.07-1.79,1.44-2.77.75-.86-.61-.98-1.71-.35-2.8.57.42.04,1.45.92,1.51.76.05,1.24-.53,1.74-1,.47-.44.91-.91,1.32-1.4.63-.75,1.31-1.01,2.21-.27-.06-1.18-.73-2.03-1.05-2.99-.33-.97-.73-1.93-1.41-2.85,1.12-.48,1.8-.29,2.27.91,1.18,3.01,2.46,5.98,3.74,9.07Z"/>
              <path class="cls-1" d="M74.96,51.24c-.21,5.5,1.98,7.17,7.71,6.09-1.51,2.09-4.6,2.77-6.38,1.41-2.53-1.94-3.18-5.14-1.33-7.5Z"/>
              <path class="cls-1" d="M26.83,49.17c1.23.18,2.14.73,2.36,2.06.21,1.33-.22,1.94-2.13,2.99,1.37.46,2.41,1.18,2.14,2.76-.25,1.45-1.12,2.34-2.67,2.43-.32.01-.63.02-.95.04-.29-.02-.58-.04-.87-.05.02-.1.05-.2.07-.3,1.18.08,1.87-.68,2.52-1.48.44-.54.53-1.17.24-1.8-.29-.64-.77-.96-1.52-.94-.43.01-.96.24-1.34-.27,2.97-1.7,3.06-1.8,3.02-3.13-.03-1-.47-1.68-1.47-1.94.03-.4.4-.24.6-.36Z"/>
              <path class="cls-1" d="M58.37,49.16c1.3.18,2.23.78,2.39,2.19.23,2.09-1.4,2.45-2.82,2.99,1.11,1.56,2.05,3.2,2.79,4.97-1.24.32-1.8-.07-2.31-1.21-.55-1.23-.96-2.7-2.59-3.34.83-.42,1.48-.76,2.14-1.09.9-.45,1.3-1.2,1.23-2.17-.06-.93-.37-1.75-1.43-1.98.05-.37.4-.24.6-.37Z"/>
              <path class="cls-1" d="M30.63,54.14c0-1.38.03-2.76-.01-4.13-.02-.55-.04-.93.71-.95.77-.02.86.31.85.97-.03,2.85-.03,5.71,0,8.56,0,.65-.16.84-.81.85-.69,0-.79-.25-.77-.88.06-1.47.02-2.95.02-4.43Z"/>
              <path class="cls-1" d="M54.26,53.43c0,1.07,0,2.14,0,3.21-.11.83-.24,1.66.17,2.46-1.5.67-1.73.54-1.73-.86,0-2.99,0-5.98,0-8.97,1.07-.26,1.65-.05,1.5,1.26-.11.96.03,1.94.06,2.91Z"/>
              <path class="cls-1" d="M21.17,59.31c0-3.35,0-6.7,0-10.06.55,0,1.18-.34,1.59.34,0,3.13,0,6.26,0,9.4-.42.64-1.04.27-1.58.32Z"/>
              <path class="cls-1" d="M38.51,49.58c-.02,2.95-.05,5.9-.04,8.85,0,.59.09,1.03-.77,1.01-.85-.01-.78-.45-.78-1.04,0-2.95-.03-5.9-.05-8.85.55-.54,1.1-.59,1.64.02Z"/>
              <path class="cls-1" d="M48.05,49.59c0,2.84-.02,5.68-.03,8.52,0,.42,0,.84,0,1.25-.12.03-.23.05-.35.08-.4-.05-.81-.09-1.21-.14-.02-3.25-.04-6.5-.07-9.74.56-.55,1.12-.58,1.66.03Z"/>
              <path class="cls-1" d="M83.81,49.2c-.05,1.36-.73,1.8-1.94,1.64-1.94-.26-3.89-.48-6.04-.75,2.63-1.77,5.39-.39,7.97-.9Z"/>
              <path class="cls-1" d="M48.05,49.59c-.54-.61-1.1-.57-1.66-.03-.88.05-1.76.09-2.64.16-.26.02-.51.08-.58-.24-.08-.38.14-.55.48-.55,2.41,0,4.82-.01,7.22,0,.33,0,.59.17.51.55-.09.41-.4.33-.7.26-.87-.23-1.76-.15-2.64-.14Z"/>
              <path class="cls-1" d="M38.51,49.58c-.54-.6-1.09-.56-1.64-.02-.89.05-1.78.09-2.66.17-.26.02-.5.08-.57-.25-.08-.38.14-.56.49-.56,2.43,0,4.86,0,7.29,0,.35,0,.56.2.48.57-.07.31-.33.34-.58.26-.92-.28-1.87-.17-2.8-.18Z"/>
              <path class="cls-1" d="M54.26,53.43c-.03-.97-.17-1.96-.06-2.91.15-1.31-.43-1.52-1.5-1.26,1.88-.61,3.77-.42,5.67-.1-.2.12-.55,0-.6.37q-3.14-.02-3.32,3.21c-.01.23-.12.46-.19.68Z"/>
              <path class="cls-1" d="M22.75,49.59c-.41-.67-1.04-.34-1.59-.34,1.88-.6,3.78-.42,5.67-.09-.2.12-.57-.04-.6.36-1.16.02-2.32.04-3.48.06Z"/>
              <path class="cls-1" d="M21.17,59.31c.54-.06,1.16.31,1.58-.32.68.03,1.36.07,2.04.1-.02.1-.05.2-.07.3-1.19.34-2.38.48-3.54-.08Z"/>
              <path class="cls-1" d="M54.42,59.09c-.41-.79-.28-1.63-.17-2.46.34.8.22,1.63.17,2.46Z"/>
              <path class="cls-1" d="M48.01,59.37c0-.42,0-.84,0-1.25.26.42.45.84,0,1.25Z"/>
              <path class="cls-1" d="M46.46,59.31c.4.05.81.09,1.21.14-.43.23-.86.41-1.21-.14Z"/>
              <path class="cls-1" d="M25.59,59.44c.32-.01.63-.02.95-.04-.31.31-.62.32-.95.04Z"/>
              <path class="cls-1" d="M68.73,54.92c.07,0,.14-.02.2-.03-.01.06-.03.12-.04.18-.05-.06-.09-.13-.14-.19,0,0-.02.04-.02.04Z"/>
              <path class="cls-1" d="M8.08,49.74c.02-.7-.4-.67-.86-.65-.39.01-.76-.05-.79.58-.07,1.49-.16,3.07-.16,4.47,0,0,0,.01,0,.02H1.55c0-1.37-.01-2.75,0-4.12,0-.5.18-.98-.65-.97-.71,0-.93.22-.89.94.06,1.43.02,2.86.02,4.28,0,1.38.02,2.76,0,4.14-.01.58-.09,1.02.77,1.03.86,0,.77-.41.77-1-.02-1.36,0-2.73,0-4.09h4.73c.01,1.35.12,2.84.17,4.26.03.71.22.8.81.82.66.03.84-.2.82-.84-.05-1.43-.02-2.86-.01-4.28,0-1.53-.03-3.05.01-4.58Z"/>
            </svg>
          </div>
      </div>
      <!-- Derechos reservados -->
      <div class="footer-bottom">
          <p>&copy; 2024 Diseño de interfaces Equipo6 | Todos los derechos reservados.</p>
      </div>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-vksfnXRsDjpNnSXy2uc9YlQ4J5Y0B2+JbqcR8eWbJgW6U4ffSe5fUzI2Fn1+zX5s" crossorigin="anonymous"></script>
  <script>
    function toggleNotificationPopup() {
        const popup = document.getElementById('notification-popup');
        popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    }

    // Cerrar el cuadro emergente si se hace clic fuera
    window.onclick = function(event) {
        const popup = document.getElementById('notification-popup');
        if (!event.target.closest('.notification-icon')) {
            popup.style.display = 'none';
        }
    }

    // Esta función se encarga de actualizar las notificaciones dinámicamente
    function actualizarNotificaciones() {
        fetch('/obtener_notificaciones/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest' // Para indicar que es una solicitud AJAX
            },
        })
        .then(response => response.json())
        .then(data => {
            // Actualizamos el contenido de las notificaciones
            const notificationContent = document.getElementById('notification-content');
            const notificationCount = document.getElementById('notification-count');

            // Limpiar el contenido previo
            notificationContent.innerHTML = '';

            if (data.notificaciones.length > 0) {
                data.notificaciones.forEach(notificacion => {
                    const notificacionDiv = document.createElement('div');
                    notificacionDiv.classList.add('notification-item');
                    notificacionDiv.innerHTML = `<strong>${notificacion.titulo}</strong><br>${notificacion.descripcion}<br><em>${notificacion.mensaje_motivacional}</em>`;
                    notificationContent.appendChild(notificacionDiv);
                });
            } else {
                notificationContent.innerHTML = '<div class="notification-item">¡Felicitaciones! Has completado todos tus hábitos hoy.</div>';
            }

            // Actualizar el contador de notificaciones no leídas
            notificationCount.textContent = data.notificaciones_no_leidas || '0';
        })
        .catch(error => console.error('Error al obtener las notificaciones:', error));
    }

    // Llamar a la función de actualización cada vez que se carga la página
    document.addEventListener('DOMContentLoaded', function() {
        actualizarNotificaciones();
    });
  </script>
</body>
</html>
